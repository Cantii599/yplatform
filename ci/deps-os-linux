#!/usr/bin/env bash
set -euo pipefail
set -x

[ "${EUID}" -eq 0 ] || [ -n "${TEAMCITY_VERSION}" ] || {
    >&2 echo "Run as root"
    exit 1
}

function on_exit() {
    local STATUS=$?
    set +x
    exit ${STATUS}
}

trap on_exit EXIT

SUPPORT_FIRECLOUD_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"
${SUPPORT_FIRECLOUD_DIR}/ci/linux/bootstrap

apt-get install -y --force-yes \
    gettext \
    graphviz \
    libonig-dev \
    texinfo

# Java
apt-add-repository -y ppa:webupd8team/java
echo debconf shared/accepted-oracle-license-v1-1 select true | debconf-set-selections
echo debconf shared/accepted-oracle-license-v1-1 seen true | debconf-set-selections

# Erlang
curl -O https://packages.erlang-solutions.com/erlang-solutions_1.0_all.deb
dpkg -i erlang-solutions_1.0_all.deb

# NodeJS
curl -sL https://deb.nodesource.com/setup_8.x | bash -
# sudo apt-get update # happens in the nodesource.com script

apt-get install -y --force-yes \
    erlang \
    nodejs \
    oracle-java8-installer \
    oracle-java8-set-default

# JSON
npm install --global json
