#!/usr/bin/env bash

#- teamcity-api-build-info 1.0
## Usage: teamcity-api-build-info [OPTION]... BUILD_ID
## Return TeamCity info of a build ID as JSON/XML.
##
##   -a, --accept   Set accepted media-type.        Defaults to application/json.
##
##   -h, --help     Display this help and exit
##   -v, --version  Output version information and exit

DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
TOP="$(cd ${DIR}/../.. && pwd)"
source ${TOP}/support/sh/common.inc.sh

while [[ $# -gt 0 ]]; do
    case "$1" in
        -a|--accept)
            MEDIA_TYPE=${2}
            shift 2
            ;;
        -h|--help)
            sh_script_usage
            ;;
        -v|--version)
            sh_script_version
            ;;
        -* )
            usage
            ;;
        *)
            break
            ;;
    esac
done

MEDIA_TYPE=${MEDIA_TYPE:-application/json}

BUILD_ID=$1

curl \
    -sS \
    -H"Accept: ${MEDIA_TYPE}" \
    "${TEAMCITY_URL}/guestAuth/app/rest/builds/${BUILD_ID}"
