#!/usr/bin/env bash

SUPPORT_FIRECLOUD_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"
source ${SUPPORT_FIRECLOUD_DIR}/bin/common.inc.sh

#- teamcity-build-url 1.0
## Usage: teamcity-build-url [OPTION]... BUILD_ID
## Return TeamCity URL of a build ID
##
##   -t, --tab     Build tab. Defaults to buildResultsDiv
##   -q, --queued  Is build queued?
##
##   -h, --help     Display this help and exit
##   -v, --version  Output version information and exit

while [[ $# -gt 0 ]]; do
    case "$1" in
        -q|--queued)
            VIEW="Queued"
            BUILD_ID_PARAM=itemId
            TAB=${TAB:-queuedBuildOverviewTab}
            shift 1
            ;;
        -t|--tab)
            TAB="$2"
            shift 2
            ;;
        -h|--help)
            sh_script_usage
            ;;
        -v|--version)
            sh_script_version
            ;;
        -* )
            usage
            ;;
        *)
            break
            ;;
    esac
done

VIEW=${VIEW:-Log}
BUILD_ID_PARAM=${BUILD_ID_PARAM:-buildId}
TAB=${TAB:-buildResultsDiv}

BUILD_ID=$1

echo "${TEAMCITY_URL}/view${VIEW}.html?${BUILD_ID_PARAM}=${BUILD_ID}&tab=${TAB}"
