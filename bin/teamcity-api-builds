#!/usr/bin/env bash
set -euo pipefail

SUPPORT_FIRECLOUD_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"
source ${SUPPORT_FIRECLOUD_DIR}/bin/common.inc.sh

#- teamcity-api-builds 1.0
## Usage: teamcity-api-builds [OPTION]... BUILD_LOCATOR
## Return TeamCity info of builds located via BUILD_LOCATOR as JSON/XML.
##
##   -a, --accept   Set accepted media-type. Defaults to application/json
##
##   -h, --help     Display this help and exit
##   -v, --version  Output version information and exit

while [[ $# -gt 0 ]]; do
    case "$1" in
        -a|--accept)
            MEDIA_TYPE=${2}
            shift 2
            ;;
        -h|--help)
            sh_script_usage
            ;;
        -v|--version)
            sh_script_version
            ;;
        -* )
            usage
            ;;
        *)
            break
            ;;
    esac
done

MEDIA_TYPE=${MEDIA_TYPE:-application/json}

BUILD_LOCATOR=$1

curl \
    -sS \
    -H"Accept: ${MEDIA_TYPE}" \
    "${TEAMCITY_URL}/guestAuth/app/rest/builds/?locator=${BUILD_LOCATOR}"
